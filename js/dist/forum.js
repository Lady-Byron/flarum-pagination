(()=>{var t={n:n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},d:(n,e)=>{for(var i in e)t.o(e,i)&&!t.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:e[i]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n);const e=flarum.core.compat["common/app"];var i=t.n(e);const s=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/DiscussionComposer"];var a=t.n(o);const r=flarum.core.compat["forum/utils/DiscussionControls"];var u=t.n(r);const l=flarum.core.compat["forum/app"];var c=t.n(l);const p=flarum.core.compat["forum/components/SettingsPage"];var f=t.n(p);const h=flarum.core.compat["common/components/FieldSet"];var g=t.n(h);const d=flarum.core.compat["common/utils/ItemList"];var v=t.n(d);const y=flarum.core.compat["common/components/Switch"];var P=t.n(y);const b=flarum.core.compat["common/utils/Stream"];var D=t.n(b);function L(){return L=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},L.apply(this,arguments)}const O=flarum.core.compat["forum/states/DiscussionListState"];var w=t.n(O);function C(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function S(){try{var t=new URL(window.location.href).searchParams.get("page"),n=parseInt(t,10);return Number.isFinite(n)&&n>0?n:null}catch(t){return null}}function k(t,n){void 0===n&&(n=!0);try{var e=new URL(window.location.href);t<=1?e.searchParams.delete("page"):e.searchParams.set("page",String(t));var i=e.pathname+e.search+e.hash,s=window&&window.m||null;s&&s.route&&"function"==typeof s.route.set?s.route.set(i,void 0,{replace:!0}):(n?history.replaceState:history.pushState).call(history,null,"",i)}catch(t){}}function I(){try{var t,n=window&&window.m||null;if(null!=n&&null!=(t=n.route)&&t.get)return String(n.route.get())}catch(t){}return location.pathname+location.search+(location.hash||"")}var _="lbtc:dl:pendingBack";function A(t,n){try{var e,i=t.requestParams?t.requestParams():{},s={base:location.pathname,include:i.include||[],filter:i.filter||{},sort:i.sort||null,perPage:(null==(e=t.options)?void 0:e.perPage)||20,page:Number(n)||1};return"lbtc:dl:pagecache:"+JSON.stringify(s)}catch(t){return null}}function R(t,n){try{var e=A(t,n);e&&sessionStorage.removeItem(e)}catch(t){}}function x(){w().prototype.initOptions=function(){this.options={cacheDiscussions:i().forum.attribute("foskym-pagination.cacheDiscussions"),perPage:i().forum.attribute("foskym-pagination.perPage"),perLoadMore:i().forum.attribute("foskym-pagination.perLoadMore"),perIndexInit:i().forum.attribute("foskym-pagination.perIndexInit"),leftEdges:4,rightEdges:5},this.usePaginationMode=function(){if(null===c().session.user)return c().forum.attribute("foskym-pagination.paginationOnLoading");var t=c().session.user.preferences();return c().forum.attribute("foskym-pagination.canUserPref")&&t["foskym-pagination.userCustom"]?!!t["foskym-pagination.userPaginationOnLoading"]:c().forum.attribute("foskym-pagination.paginationOnLoading")}(),this.lastTotalDiscussionCount=0,this.lastTotalPages=0,this.lastDiscussions=[],this.lastLoadedPage={},this.lastRequestParams={},this.optionInitialized=!0,this.__paramsRefreshedOnce=!1},(0,s.override)(w().prototype,"refreshParams",(function(t,n,e){var i=this;void 0===e&&(e=1);var s=t(n,e);if(!this.usePaginationMode||"function"!=typeof this.refresh)return s;var o=function(){try{var t=sessionStorage.getItem(_);if(!t)return!1;var n=JSON.parse(t),e=n&&n.base===I()&&Date.now()-(n.t||0)<6e5;return e&&sessionStorage.removeItem(_),!!e}catch(t){return!1}}(),a=!this.__paramsRefreshedOnce;if(o||a){var r,u;this.__paramsRefreshedOnce=!0;var l=null!=(r=S())?r:null!=(u=e)?u:1;return Promise.resolve(s).then((function(){return i.refresh(l)}))}return this.__bypassSessionOnce=!0,R(this,1),Promise.resolve(s).then((function(){return i.refresh(1)}))})),(0,s.override)(w().prototype,"refresh",(function(t,n){var e=this;if(void 0===n&&(n=1),this.optionInitialized||this.initOptions(),!this.usePaginationMode)return this.pageSize=this.options.perLoadMore,t(n);var s=n;if(void 0===s||1===s){var o=S();o&&(s=o)}if(!this.__bypassSessionOnce){var a=function(t,n){try{var e,s=A(t,n);if(!s)return null;var o=sessionStorage.getItem(s);if(!o)return null;var a=JSON.parse(o);if(!a||!Array.isArray(a.ids)||!a.ids.length)return null;for(var r,u=t.type||"discussions",l=[],c=function(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return C(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?C(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(a.ids);!(r=c()).done;){var p=r.value,f=i().store.getById&&i().store.getById(u,p)||i().store.getBy&&i().store.getBy(u,"id",p)||null;if(!f)return null;l.push(f)}var h=Math.ceil((a.total||0)/(a.perPage||(null==(e=t.options)?void 0:e.perPage)||20)),g={};n>1&&(g.prev=!0),n<h&&(g.next=!0);var d=l;return d.payload={jsonapi:{totalResultsCount:a.total||0},links:g},d}catch(t){return null}}(this,s);if(a)return this.silentRestoreOnce=!0,this.initialLoading=!1,this.loadingPrev=!1,this.loadingNext=!1,this.isRefreshing=!1,this.location={page:s},k(s,!0),this.pages=[],this.parseResults(this.location.page,a),"undefined"!=typeof m&&m.redraw&&m.redraw(),setTimeout((function(){return e.silentRestoreOnce=!1}),0),Promise.resolve(a)}return this.__bypassSessionOnce=!1,this.initialLoading=!0,this.loadingPrev=!1,this.loadingNext=!1,this.isRefreshing=!0,this.clear(),this.location={page:s},k(s,!0),this.loadPage(s).then((function(t){e.pages=[],e.parseResults(e.location.page,t)})).finally((function(){e.initialLoading=!1,e.isRefreshing=!1}))})),(0,s.override)(w().prototype,"loadPage",(function(t,n){void 0===n&&(n=1);var e=this.requestParams();this.optionInitialized||this.initOptions(),this.lastRequestParams.include||(this.lastRequestParams=e);var s=i().preloadedApiDocument();if(s)return this.initialLoading=!1,this.isRefreshing=!1,this.totalDiscussionCount=D()(s.payload.jsonapi.totalResultsCount),this.lastTotalDiscussionCount=this.totalDiscussionCount(),Promise.resolve(s);if(!this.isRefreshing&&this.options.cacheDiscussions){var o=JSON.stringify(e.include)!==JSON.stringify(this.lastRequestParams.include),a=JSON.stringify(e.filter)!==JSON.stringify(this.lastRequestParams.filter),r=e.sort!==this.lastRequestParams.sort;if(!(o||a||r)&&this.lastLoadedPage[n]){var u=this.options.perPage*(n-1),l=this.options.perPage*n,c=this.lastDiscussions.slice(u,l);return c.payload={jsonapi:{totalResultsCount:this.totalDiscussionCount()}},this.initialLoading=!0,m.redraw(),new Promise((function(t){return setTimeout((function(){return t(c)}),50)}))}}var p,f,h=Array.isArray(e.include)?e.include.join(","):e.include;this.usePaginationMode?(p=this.options.perPage*(n-1),f=this.options.perPage):f=0==(p=this.options.perIndexInit*Math.min(n-1,1)+this.options.perLoadMore*Math.max(n-2,0))?this.options.perIndexInit:this.options.perLoadMore;var g=L({},e,{page:L({},e.page,{offset:p,limit:f}),include:h});return i().store.find(this.type,g)})),(0,s.override)(w().prototype,"getAllItems",(function(t){return"walsgit-discussion-cards"in flarum.extensions?this.extraDiscussions.concat(this.getPages(!0).map((function(t){return t.items})).flat()):t()})),(0,s.override)(w().prototype,"getPages",(function(t,n){var e=this;void 0===n&&(n=!1);var i=t();return"walsgit-discussion-cards"in flarum.extensions?n?i:[i.find((function(t){return t.number===e.location.page}))]:i})),(0,s.override)(w().prototype,"parseResults",(function(t,n,e){var i;if(!this.usePaginationMode)return t(n,e);var s=Number(n),o=(null==(i=e.payload)?void 0:i.links)||{},a={number:s,items:e,hasNext:!(null==o||!o.next),hasPrev:!(null==o||!o.prev)};if(this.hasPage=function(t){var n=this.getPages(!0);return 0!==n.length&&n.some((function(n){return n.number===t}))},this.hasPage(s)||this.pages.push(a),this.pages=this.pages.sort((function(t,n){return t.number-n.number})),this.location={page:s},this.totalDiscussionCount=D()(e.payload.jsonapi.totalResultsCount),this.options.cacheDiscussions)if(this.lastTotalDiscussionCount!==this.totalDiscussionCount()&&0!==this.lastTotalDiscussionCount||0===this.lastTotalDiscussionCount||this.isRefreshing)this.lastTotalDiscussionCount=this.totalDiscussionCount(),this.lastDiscussions=new Array(this.lastTotalDiscussionCount),this.lastLoadedPage={};else{var r;this.lastLoadedPage[s]=a;var u=this.options.perPage*(s-1),l=this.options.perPage*s;(r=this.lastDiscussions).splice.apply(r,[u,l-u].concat(e))}this.getTotalPages=function(){return Math.ceil(this.totalDiscussionCount()/this.options.perPage)},this.page=D()(a),this.perPage=D()(this.options.perPage),this.totalPages=D()(this.getTotalPages()),function(t,n,e){try{var i,s=A(t,n);if(!s)return;var o={ids:Array.isArray(e)?e.map((function(t){return t&&t.id&&t.id()})):[],total:t.totalDiscussionCount&&t.totalDiscussionCount()||e&&e.payload&&e.payload.jsonapi&&e.payload.jsonapi.totalResultsCount||0,ts:Date.now(),perPage:(null==(i=t.options)?void 0:i.perPage)||20};sessionStorage.setItem(s,JSON.stringify(o))}catch(t){}}(this,s,e),this.ctrl={scrollToTop:function(){var t=document.querySelector("#content > .IndexPage > .container"),n=document.querySelector("#header"),e=0;if(n&&(e=n.clientHeight),t){var i=t.getBoundingClientRect().top+window.scrollY-e;setTimeout((function(){return window.scrollTo({top:i,behavior:"smooth"})}),50)}}.bind(this),prevPage:function(){var t=this,n=this.page().number-1;n<1||(this.page(n),this.loadingPrev=!0,this.loadPage(n).then((function(e){t.parseResults(n,e),t.loadingPrev=!1,k(n,!0),t.ctrl.scrollToTop()})))}.bind(this),nextPage:function(){var t=this,n=this.page().number+1;n>this.totalPages()?n=this.totalPages():(this.page(n),this.loadingNext=!0,this.loadPage(n).then((function(e){t.parseResults(n,e),t.loadingNext=!1,k(n,!0),t.ctrl.scrollToTop()})))}.bind(this),toPage:function(t){var n=this,e=Number(t);this.page().number===e||e<1||e>this.totalPages()||(this.page(e),this.initialLoading=!0,this.loadPage(e).then((function(t){n.parseResults(e,t),n.initialLoading=!1,k(e,!0),n.ctrl.scrollToTop()})))}.bind(this),pageList:function(){for(var t=[],n=Math.max(parseInt(this.page().number)-this.options.leftEdges,1),e=Math.min(parseInt(this.page().number)+this.options.rightEdges,this.totalPages()),i=n;i<=e;i++)t.push(i);return t}.bind(this)},m.redraw()})),(0,s.override)(w().prototype,"addDiscussion",(function(t,n){var e=this;if(!this.usePaginationMode)return t(n);clearTimeout(this.__rtRefreshTimer),this.__rtRefreshTimer=setTimeout((function(){e.page=e.page||D()({number:1,items:[]}),e.location={page:1},e.__bypassSessionOnce=!0,R(e,1),e.refresh(1)}),50);var i=this.lastDiscussions.indexOf(n);-1!==i?(this.lastDiscussions.splice(i),this.lastDiscussions.unshift(n)):(this.lastDiscussions.unshift(n),this.lastTotalDiscussionCount++,this.totalDiscussionCount(this.lastTotalDiscussionCount)),m.redraw()})),(0,s.override)(w().prototype,"deleteDiscussion",(function(t,n){if(!this.usePaginationMode)return t(n);var e=this.lastDiscussions.indexOf(n);-1!==e&&(this.lastDiscussions.splice(e),this.lastTotalDiscussionCount--,this.totalDiscussionCount(this.lastTotalDiscussionCount)),m.redraw()})),(0,s.override)(w().prototype,"clear",(function(t){return this.usePaginationMode?(this.lastDiscussions=[],this.lastLoadedPage={},this.lastRequestParams={},this.lastTotalDiscussionCount=0,this.lastTotalPages=0,this.totalDiscussionCount=D()(0),t()):t()}))}window.__dlBackMarkerInstalled||(window.__dlBackMarkerInstalled=!0,document.addEventListener("click",(function(t){var n=t.target;if(n&&(null==n.closest?void 0:n.closest('a[href*="/d/"]')))try{sessionStorage.setItem(_,JSON.stringify({t:Date.now(),base:I()}))}catch(t){}}),{capture:!0,passive:!0}));const N=flarum.core.compat["forum/components/DiscussionList"];var T=t.n(N);const B=flarum.core.compat["forum/components/DiscussionListItem"];var M=t.n(B);const j=flarum.core.compat["common/utils/classList"];var J=t.n(j);function q(t,n){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},q(t,n)}const F=flarum.core.compat["common/Component"];var U=t.n(F);const E=flarum.core.compat["common/components/Button"];var z=t.n(E),H=function(t){var n,e;function i(){for(var n,e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return(n=t.call.apply(t,[this].concat(i))||this).attrs=void 0,n}e=t,(n=i).prototype=Object.create(e.prototype),n.prototype.constructor=n,q(n,e);var s=i.prototype;return s.view=function(t){var n=this.attrs.state;return m("div",{className:"Pagination"},m("ul",{class:"IndexPage-toolbar-view"},m("li",null,this.buttonFirst()),m("li",null,this.buttonBack()),n.ctrl.pageList().map((function(t){return m("li",null,m(z(),{title:t,className:n.page().number==t?"Button Button--primary Button--active":"Button",onclick:function(){n.ctrl.toPage(t)}},t))})),m("li",null,this.buttonNext()),m("li",null,this.buttonLast()),m("li",null,this.inputJump()),m("li",null,this.buttonJump())))},s.buttonFirst=function(){var t=this.attrs.state;return z().component({title:"First",icon:"fa fa-angle-double-left fas fa-angles-left",className:"Button Button--icon",onclick:function(){t.ctrl.toPage(1)},disabled:1==t.page().number})},s.buttonBack=function(){var t=this.attrs.state;return z().component({title:"Back",icon:"fa fa-angle-left fas",className:"Button Button--icon",onclick:function(){var n=t.page().number;t.ctrl.toPage(parseInt(n)-1)},disabled:1==t.page().number})},s.buttonNext=function(){var t=this.attrs.state;return z().component({title:"Next",icon:"fa fa-angle-right fas",className:"Button Button--icon",onclick:function(){var n=t.page().number;t.ctrl.toPage(parseInt(n)+1)},disabled:t.page().number==t.totalPages()})},s.buttonLast=function(){var t=this.attrs.state;return z().component({title:"Last",icon:"fa fa-angle-double-right fas fa-angles-right",className:"Button Button--icon",onclick:function(){var n=parseInt(t.totalPages());t.ctrl.toPage(n)},disabled:t.page().number==t.totalPages()})},s.JumpFunc=function(){var t,n=this.attrs.state,e=parseInt(null==(t=document.getElementById("pagination-inputJump"))?void 0:t.value);Number.isFinite(e)&&Number.isSafeInteger(e)&&e!=n.page().number&&1<=e&&e<=n.totalPages()&&n.ctrl.toPage(e)},s.inputJump=function(){var t=this,n=this.attrs.state;return m("input.FromControl",{id:"pagination-inputJump",placeholder:void 0===n.page().number?"":""+n.page().number,onkeydown:function(n){n.redraw=!1,13==n.keyCode&&(n.redraw=!0,t.JumpFunc())}})},s.buttonJump=function(){return z().component({title:"Jump",icon:"fa fa-paper-plane fas",className:"Button Button--icon",onclick:this.JumpFunc.bind(this)})},i}(U());function Y(){(0,s.override)(T().prototype,"view",(function(t){var n,e,s=null==(n=this.attrs)?void 0:n.state,o=t();if(o.attrs=o.attrs||{},o.attrs.className=J()("DiscussionList",{"DiscussionList--searchResults":null==s||null==s.isSearchResults?void 0:s.isSearchResults()},o.attrs.className),null!=s&&s.silentRestoreOnce){var a=function(t){return t&&"object"==typeof t&&t.attrs&&(n=t.attrs,String(n&&(n.className||n.class)||"")).includes("LoadingIndicator");var n};!function t(n){if(n)if(Array.isArray(n))for(var e=n.length-1;e>=0;e--){var i=n[e];a(i)?n.splice(e,1):t(i)}else if("string"!=typeof n&&"number"!=typeof n){var s,o=(s=n,Array.isArray(s)?s:s&&Array.isArray(s.children)?s.children:null);if(o)for(var r=o.length-1;r>=0;r--){var u=o[r];a(u)?o.splice(r,1):t(u)}}}(o)}if(null==s||!s.usePaginationMode||null!=s.isLoading&&s.isLoading()||null!=s.isEmpty&&s.isEmpty())return o;var r="walsgit-discussion-cards"in flarum.extensions,u=(null==(e=s.options)?void 0:e.perPage)||0,l=s.page||1,c=(null==s.getParams?void 0:s.getParams())||{},p=s.getPages?s.getPages(!0):[],f=[];if(Array.isArray(p)&&p.length){var h=p.find((function(t){var n;return(null==t?void 0:t.number)===(null==(n=s.location)?void 0:n.page)}))||p[0];h&&Array.isArray(h.items)&&(f=h.items)}var g=f.length?f.map((function(t,n){return m("li",{key:t.id(),"data-id":t.id(),role:"article","aria-setsize":-1,"aria-posinset":l*u+n},m(M(),{discussion:t,params:c}))})):null,d=function(t){return Array.isArray(t)?t:t&&Array.isArray(t.children)?t.children:null},v=[];if(function t(n,e,i){if(n)if(Array.isArray(n))for(var s=0;s<n.length;s++)t(n[s],n,s);else if("string"!=typeof n&&"number"!=typeof n){(r=n)&&"ul"===r.tag&&(u=r.attrs,String(u&&(u.className||u.class)||"")).includes("DiscussionList-discussions")&&v.push({node:n,parent:e,index:i});var o=d(n);if(o)for(var a=0;a<o.length;a++)t(o[a],n,a)}var r,u}(o,null,null),r)return S(C(),o,v.length?v[0]:null,s),o;if(v.length>0){var y=v.find((function(t){var n=d(t.node);return n&&n.some((function(t){return t&&"li"===t.tag}))}))||v.find((function(t){var n;return(null==(n=t.node)?void 0:n.attrs)&&"aria-busy"in t.node.attrs}))||v[0];if(g){var P=d(y.node);P?P.splice.apply(P,[0,P.length].concat(g)):y.node.children=g}for(var b=v.length-1;b>=0;b--){var D,L=v[b];if(L!==y){var O=d((Array.isArray(L.parent),L.parent));if(O){var w=null!=(D=L.index)?D:O.indexOf(L.node);w>=0&&O[w]===L.node&&((d(L.node)||[]).some((function(t){return t&&"li"===t.tag}))||O.splice(w,1))}}}return S(C(),o,y,s),o}return S(C(),o,null,s),o;function C(){return i().forum.attribute("foskym-pagination.paginationPosition")}function S(t,n,e,i){var s="above"===t||"both"===t,o="under"===t||"both"===t;if(s||o){var a=H.component({state:i});if(e&&e.parent){var r,u=e.parent,l=d((Array.isArray(u),u));if(!l)return;var c=null!=(r=e.index)?r:l.indexOf(e.node);c<0&&(c=0),s&&l.splice(c,0,a),o&&l.splice(c+(s?2:1),0,a)}else{var p=d(n);if(!p)return;s&&p.unshift(a),o&&p.push(a)}}}}))}i().initializers.add("foskym/flarum-pagination",(function(){(0,s.extend)(f().prototype,"oninit",(function(){var t=this.user.preferences();this.userCustom=D()(t["foskym-pagination.userCustom"]),this.userPaginationOnLoading=D()(t["foskym-pagination.userPaginationOnLoading"])})),(0,s.extend)(f().prototype,"settingsItems",(function(t){Boolean(c().forum.attribute("foskym-pagination.canUserPref"))&&t.add("pagination_settings",g().component({label:c().translator.trans("foskym-pagination.forum.user.settings.head"),className:"SettingsPage-pagination"},this.Pagination_UserPrefItems().toArray()))})),f().prototype.Pagination_UserPrefItems=function(){var t=this,n=new(v());return n.add("foskym-pagination.userCustom",P().component({state:this.user.preferences()["foskym-pagination.userCustom"],onchange:function(n){t.UserCustom_Loading=!0,t.user.savePreferences({"foskym-pagination.userCustom":n}).then((function(){t.UserCustom_Loading=!1,m.redraw()}))},loading:this.UserCustom_Loading},c().translator.trans("foskym-pagination.forum.user.settings.userCustom"))),this.user.preferences()["foskym-pagination.userCustom"]&&n.add("foskym-pagination.userPaginationOnLoading",P().component({state:this.user.preferences()["foskym-pagination.userPaginationOnLoading"],onchange:function(n){t.userPaginationOnLoading_Loading=!0,t.user.savePreferences({"foskym-pagination.userPaginationOnLoading":n}).then((function(){t.userPaginationOnLoading_Loading=!1,m.redraw()}))},loading:this.userPaginationOnLoading_Loading},c().translator.trans("foskym-pagination.forum.user.settings.userPaginationOnLoading"))),n},x(),Y(),(0,s.extend)(u(),"deleteAction",(function(){if(this.usePaginationMode&&i().discussions){var t=i().discussions.location.page;i().discussions.refresh(t)}})),(0,s.extend)(a().prototype,"onsubmit",(function(){this.usePaginationMode&&i().discussions&&i().discussions.refresh()}))}),-2)})(),module.exports=n})();
//# sourceMappingURL=forum.js.map