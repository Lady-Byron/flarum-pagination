{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@foskym/flarum-pagination/webpack/bootstrap","webpack://@foskym/flarum-pagination/webpack/runtime/compat get default export","webpack://@foskym/flarum-pagination/webpack/runtime/define property getters","webpack://@foskym/flarum-pagination/webpack/runtime/hasOwnProperty shorthand","webpack://@foskym/flarum-pagination/webpack/runtime/make namespace object","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/app']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/extend']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/utils/DiscussionControls']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/app']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/components/SettingsPage']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/components/FieldSet']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@foskym/flarum-pagination/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@foskym/flarum-pagination/./src/forum/overrideDiscussionListState.js","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/components/DiscussionList']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@foskym/flarum-pagination/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/Component']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/components/Button']\"","webpack://@foskym/flarum-pagination/./src/forum/components/Toolbar.tsx","webpack://@foskym/flarum-pagination/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@foskym/flarum-pagination/./src/forum/overrideDiscussionList.js","webpack://@foskym/flarum-pagination/./src/forum/index.js","webpack://@foskym/flarum-pagination/./src/forum/addUserPreference.js","webpack://@foskym/flarum-pagination/./src/forum/utils/determineMode.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/DiscussionControls'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/SettingsPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/FieldSet'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Switch'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","export default function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/DiscussionListState'];","import app from 'flarum/common/app';\nimport { override } from 'flarum/common/extend';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport Stream from 'flarum/common/utils/Stream';\nimport determineMode from './utils/determineMode';\n\n// [URL-Persist] --- URL 持久化工具（仅对列表页加/读 ?page=） ---\nfunction getPageFromURL() {\n  try {\n    const p = new URL(window.location.href).searchParams.get('page');\n    const n = parseInt(p, 10);\n    return Number.isFinite(n) && n > 0 ? n : null;\n  } catch {\n    return null;\n  }\n}\nfunction setPageToURL(n, replace = true) {\n  try {\n    const u = new URL(window.location.href);\n    if (n <= 1) u.searchParams.delete('page'); // 第 1 页保持干净\n    else u.searchParams.set('page', String(n));\n    const newUrl = u.pathname + u.search + u.hash;\n    (replace ? history.replaceState : history.pushState).call(history, null, '', newUrl);\n  } catch {}\n}\n\nexport default function () {\n  // 初始化分页选项\n  DiscussionListState.prototype.initOptions = function () {\n    this.options = {\n      cacheDiscussions: app.forum.attribute('foskym-pagination.cacheDiscussions'),\n      perPage: app.forum.attribute('foskym-pagination.perPage'),\n      perLoadMore: app.forum.attribute('foskym-pagination.perLoadMore'),\n      perIndexInit: app.forum.attribute('foskym-pagination.perIndexInit'),\n      leftEdges: 4,\n      rightEdges: 5,\n    };\n    this.usePaginationMode = determineMode();\n    this.lastTotalDiscussionCount = 0;\n    this.lastTotalPages = 0;\n    this.lastDiscussions = [];\n    this.lastLoadedPage = {};\n    this.lastRequestParams = {};\n    this.optionInitialized = true;\n  };\n\n  // 把参数刷新串到 refresh，确保黄条触发能刷新分页\n  override(DiscussionListState.prototype, 'refreshParams', function (original, params, page = 1) {\n    const ret = original(params, page);\n    if (this.usePaginationMode && typeof this.refresh === 'function') {\n      // 保持原逻辑：最新排序时回到第 1 页\n      const goPage = 1;\n      return Promise.resolve(ret).then(() => this.refresh(goPage));\n    }\n    return ret;\n  });\n\n  // 刷新指定页\n  override(DiscussionListState.prototype, 'refresh', function (original, page = 1) {\n    if (!this.optionInitialized) this.initOptions();\n\n    if (!this.usePaginationMode) {\n      this.pageSize = this.options.perLoadMore;\n      return original(page);\n    }\n\n    // [URL-Persist] 仅当外部未显式指定页（或仍是默认 1）时，读取 URL 的 ?page\n    let targetPage = page;\n    if (targetPage === undefined || targetPage === 1) {\n      const u = getPageFromURL();\n      if (u) targetPage = u;\n    }\n\n    this.initialLoading = true;\n    this.loadingPrev = false;\n    this.loadingNext = false;\n    this.isRefreshing = true;\n\n    this.clear();\n    this.location = { page: targetPage };\n\n    // [URL-Persist] 把当前页写回 URL（不新增历史记录）\n    setPageToURL(targetPage, true);\n\n    return this.loadPage(targetPage)\n      .then((results) => {\n        this.pages = [];\n        this.parseResults(this.location.page, results);\n      })\n      .finally(() => {\n        this.initialLoading = false;\n        this.isRefreshing = false;\n      });\n  });\n\n  // 加载某页\n  override(DiscussionListState.prototype, 'loadPage', function (original, page = 1) {\n    const reqParams = this.requestParams();\n    if (!this.optionInitialized) this.initOptions();\n\n    if (!this.lastRequestParams['include']) {\n      this.lastRequestParams = reqParams;\n    }\n\n    const preloadedDiscussions = app.preloadedApiDocument();\n    if (preloadedDiscussions) {\n      this.initialLoading = false;\n      this.isRefreshing = false;\n      this.totalDiscussionCount = Stream(preloadedDiscussions.payload.jsonapi.totalResultsCount);\n      this.lastTotalDiscussionCount = this.totalDiscussionCount();\n      return Promise.resolve(preloadedDiscussions);\n    }\n\n    // 本地缓存复用（参数未变）\n    if (!this.isRefreshing && this.options.cacheDiscussions) {\n      const includeChanged = JSON.stringify(reqParams['include']) !== JSON.stringify(this.lastRequestParams['include']);\n      const filterChanged = JSON.stringify(reqParams['filter']) !== JSON.stringify(this.lastRequestParams['filter']);\n      const sortChanged = reqParams['sort'] !== this.lastRequestParams['sort'];\n\n      if (!(includeChanged || filterChanged || sortChanged)) {\n        if (this.lastLoadedPage[page]) {\n          const start = this.options.perPage * (page - 1);\n          const end = this.options.perPage * page;\n          const results = this.lastDiscussions.slice(start, end);\n          results.payload = { jsonapi: { totalResultsCount: this.totalDiscussionCount() } };\n\n          this.initialLoading = true;\n          m.redraw();\n          return new Promise((resolve) => setTimeout(() => resolve(results), 50));\n        }\n      }\n    }\n\n    const include = Array.isArray(reqParams.include) ? reqParams.include.join(',') : reqParams.include;\n\n    let newOffset, newLimit;\n    if (this.usePaginationMode) {\n      newOffset = this.options.perPage * (page - 1);\n      newLimit = this.options.perPage;\n    } else {\n      newOffset = this.options.perIndexInit * Math.min(page - 1, 1) + this.options.perLoadMore * Math.max(page - 2, 0);\n      newLimit = newOffset === 0 ? this.options.perIndexInit : this.options.perLoadMore;\n    }\n\n    const params = {\n      ...reqParams,\n      page: {\n        ...reqParams.page,\n        offset: newOffset,\n        limit: newLimit,\n      },\n      include,\n    };\n\n    return app.store.find(this.type, params);\n  });\n\n  // cards 兼容：拿所有 items\n  override(DiscussionListState.prototype, 'getAllItems', function (original) {\n    if (!('walsgit-discussion-cards' in flarum.extensions)) return original();\n    return this.extraDiscussions.concat(this.getPages(true).map((pg) => pg.items).flat());\n  });\n\n  // cards 兼容：仅返回当前页（或所有页）\n  override(DiscussionListState.prototype, 'getPages', function (original, getAllPages = false) {\n    const allPages = original();\n    if (!('walsgit-discussion-cards' in flarum.extensions)) return allPages;\n    if (getAllPages) return allPages;\n    return [allPages.find((page) => page.number === this.location.page)];\n  });\n\n  // 解析结果并更新分页状态\n  override(DiscussionListState.prototype, 'parseResults', function (original, pg, results) {\n    if (!this.usePaginationMode) return original(pg, results);\n\n    const pageNum = Number(pg);\n    const links = results.payload?.links || {};\n    const page = {\n      number: pageNum,\n      items: results,\n      hasNext: !!links?.next,\n      hasPrev: !!links?.prev,\n    };\n\n    this.hasPage = function (num) {\n      const all = this.getPages(true);\n      if (all.length === 0) return false;\n      return all.some((p) => p.number === num);\n    };\n\n    if (!this.hasPage(pageNum)) {\n      this.pages.push(page);\n    }\n\n    this.pages = this.pages.sort((a, b) => a.number - b.number);\n    this.location = { page: pageNum };\n\n    this.totalDiscussionCount = Stream(results.payload.jsonapi.totalResultsCount);\n\n    if (this.options.cacheDiscussions) {\n      if (\n        (this.lastTotalDiscussionCount !== this.totalDiscussionCount() && this.lastTotalDiscussionCount !== 0) ||\n        this.lastTotalDiscussionCount === 0 ||\n        this.isRefreshing\n      ) {\n        // 重置缓存\n        this.lastTotalDiscussionCount = this.totalDiscussionCount();\n        this.lastDiscussions = new Array(this.lastTotalDiscussionCount);\n        this.lastLoadedPage = {};\n      } else {\n        // 继续累积缓存\n        this.lastLoadedPage[pageNum] = page;\n        const start = this.options.perPage * (pageNum - 1);\n        const end = this.options.perPage * pageNum;\n        this.lastDiscussions.splice(start, end - start, ...results);\n      }\n    }\n\n    this.getTotalPages = function () {\n      return Math.ceil(this.totalDiscussionCount() / this.options.perPage);\n    };\n\n    this.page = Stream(page);\n    this.perPage = Stream(this.options.perPage);\n    this.totalPages = Stream(this.getTotalPages());\n\n    this.ctrl = {\n      scrollToTop: function () {\n        const container = document.querySelector('#content > .IndexPage > .container');\n        const header = document.querySelector('#header');\n        let offsetY = 0;\n        if (header) offsetY = header.clientHeight;\n        if (container) {\n          const target = container.getBoundingClientRect().top + window.scrollY - offsetY;\n          setTimeout(() => window.scrollTo({ top: target, behavior: 'smooth' }), 50);\n        }\n      }.bind(this),\n\n      prevPage: function () {\n        let current = this.page().number - 1;\n        if (current < 1) return;\n        this.page(current);\n        this.loadingPrev = true;\n        this.loadPage(current).then((r) => {\n          this.parseResults(current, r);\n          this.loadingPrev = false;\n          setPageToURL(current, true); // [URL-Persist]\n          this.ctrl.scrollToTop();\n        });\n      }.bind(this),\n\n      nextPage: function () {\n        let current = this.page().number + 1;\n        if (current > this.totalPages()) {\n          current = this.totalPages();\n          return;\n        }\n        this.page(current);\n        this.loadingNext = true;\n        this.loadPage(current).then((r) => {\n          this.parseResults(current, r);\n          this.loadingNext = false;\n          setPageToURL(current, true) // [URL-Persist]\n          this.ctrl.scrollToTop();\n        });\n      }.bind(this),\n\n      toPage: function (page) {\n        const target = Number(page);\n        if (this.page().number === target || target < 1 || target > this.totalPages()) return;\n        this.page(target);\n        this.initialLoading = true;\n        this.loadPage(target).then((r) => {\n          this.parseResults(target, r);\n          this.initialLoading = false;\n          setPageToURL(target, true); // [URL-Persist]\n          this.ctrl.scrollToTop();\n        });\n      }.bind(this),\n\n      pageList: function () {\n        const p = [];\n        const left = Math.max(parseInt(this.page().number) - this.options.leftEdges, 1);\n        const right = Math.min(parseInt(this.page().number) + this.options.rightEdges, this.totalPages());\n        for (let i = left; i <= right; i++) p.push(i);\n        return p;\n      }.bind(this),\n    };\n\n    m.redraw();\n  });\n\n  // ☆ 关键修复：Realtime 释放新内容时调用 addDiscussion。\n  //   在分页模式下，直接触发一次 refresh(1)（轻微去抖），\n  //   确保第 1 页立即取回新数据并显示。\n  override(DiscussionListState.prototype, 'addDiscussion', function (original, discussion) {\n    if (!this.usePaginationMode) return original(discussion);\n\n    clearTimeout(this.__rtRefreshTimer);\n    this.__rtRefreshTimer = setTimeout(() => {\n      // 如果已经在第 1 页，也刷新第 1 页；否则跳转并刷新第 1 页\n      this.page = this.page || Stream({ number: 1, items: [] });\n      this.location = { page: 1 };\n      this.refresh(1);\n    }, 50);\n\n    // 仍然维护本地计数，避免统计突变\n    const index = this.lastDiscussions.indexOf(discussion);\n    if (index !== -1) {\n      this.lastDiscussions.splice(index);\n      this.lastDiscussions.unshift(discussion);\n    } else {\n      this.lastDiscussions.unshift(discussion);\n      this.lastTotalDiscussionCount++;\n      this.totalDiscussionCount(this.lastTotalDiscussionCount);\n    }\n    m.redraw();\n  });\n\n  override(DiscussionListState.prototype, 'deleteDiscussion', function (original, discussion) {\n    if (!this.usePaginationMode) return original(discussion);\n    const index = this.lastDiscussions.indexOf(discussion);\n    if (index !== -1) {\n      this.lastDiscussions.splice(index);\n      this.lastTotalDiscussionCount--;\n      this.totalDiscussionCount(this.lastTotalDiscussionCount);\n    }\n    m.redraw();\n  });\n\n  // 清理状态\n  override(DiscussionListState.prototype, 'clear', function (original) {\n    if (!this.usePaginationMode) return original();\n    this.lastDiscussions = [];\n    this.lastLoadedPage = {};\n    this.lastRequestParams = {};\n    this.lastTotalDiscussionCount = 0;\n    this.lastTotalPages = 0;\n    this.totalDiscussionCount = Stream(0);\n    return original();\n  });\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","import Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport type Mithril from 'mithril';\n\nexport default class Toolbar extends Component {\n  attrs: any;\n  view(vnode: Mithril.Vnode) {\n    let state = this.attrs.state;\n    return (\n      <div className=\"Pagination\">\n        <ul class=\"IndexPage-toolbar-view\">\n          <li>{this.buttonFirst()}</li>\n          <li>{this.buttonBack()}</li>\n          {state.ctrl.pageList().map((page: any) => {\n            return (\n              <li>\n                <Button\n                  title={page}\n                  className={state.page().number == page ? 'Button Button--primary Button--active' : 'Button'}\n                  onclick={() => {\n                    state.ctrl.toPage(page);\n                  }}\n                >\n                  {page}\n                </Button>\n              </li>\n            );\n          })}\n          <li>{this.buttonNext()}</li>\n          <li>{this.buttonLast()}</li>\n          <li>{this.inputJump()}</li>\n          <li>{this.buttonJump()}</li>\n        </ul>\n      </div>\n    );\n  }\n\n  buttonFirst() {\n    let state = this.attrs.state;\n    return Button.component({\n      title: 'First',\n      icon: 'fa fa-angle-double-left fas fa-angles-left',\n      className: 'Button Button--icon',\n      onclick: () => {\n        state.ctrl.toPage(1);\n      },\n      disabled: state.page().number == 1,\n    });\n  }\n\n  buttonBack() {\n    let state = this.attrs.state;\n    return Button.component({\n      title: 'Back',\n      icon: 'fa fa-angle-left fas',\n      className: 'Button Button--icon',\n      onclick: () => {\n        let page = state.page().number;\n        state.ctrl.toPage(parseInt(page) - 1);\n      },\n      disabled: state.page().number == 1,\n    });\n  }\n\n  buttonNext() {\n    let state = this.attrs.state;\n    return Button.component({\n      title: 'Next',\n      icon: 'fa fa-angle-right fas',\n      className: 'Button Button--icon',\n      onclick: () => {\n        let page = state.page().number;\n        state.ctrl.toPage(parseInt(page) + 1);\n      },\n      disabled: state.page().number == state.totalPages(),\n    });\n  }\n\n  buttonLast() {\n    let state = this.attrs.state;\n    return Button.component({\n      title: 'Last',\n      icon: 'fa fa-angle-double-right fas fa-angles-right',\n      className: 'Button Button--icon',\n      onclick: () => {\n        let page = parseInt(state.totalPages());\n        state.ctrl.toPage(page);\n      },\n      disabled: state.page().number == state.totalPages(),\n    });\n  }\n\n  JumpFunc() {\n    let state = this.attrs.state;\n    let input = parseInt(document.getElementById('pagination-inputJump')?.value);\n    if (Number.isFinite(input) && Number.isSafeInteger(input)) {\n      if (input != state.page().number) {\n        if (1 <= input && input <= state.totalPages()) {\n          state.ctrl.toPage(input);\n        }\n      }\n    }\n  }\n\n  inputJump() {\n    let state = this.attrs.state;\n    return m('input.FromControl', {\n      id: 'pagination-inputJump',\n      placeholder: state.page().number === undefined ? '' : `${state.page().number}`,\n      onkeydown: (event: KeyboardEvent) => {\n        event.redraw = false;\n        if (event.keyCode == 13) {\n          event.redraw = true;\n          this.JumpFunc();\n        }\n      },\n    });\n  }\n\n  buttonJump() {\n    return Button.component({\n      title: 'Jump',\n      icon: 'fa fa-paper-plane fas',\n      className: 'Button Button--icon',\n      onclick: this.JumpFunc.bind(this),\n    });\n  }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import app from 'flarum/common/app';\nimport { override } from 'flarum/common/extend';\nimport DiscussionList from 'flarum/forum/components/DiscussionList';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport classList from 'flarum/common/utils/classList';\nimport Toolbar from './components/Toolbar';\n\n/**\n * 修复要点（仅此文件）：\n * - 绝不新建第二个 <ul.DiscussionList-discussions>。\n * - 深度遍历整棵 VDOM，原位找到现有的 UL，并只替换其 children（不改 attrs、不换节点）。\n * - 若同时存在其它“空壳”UL，就地删除（父级 children 中 splice 掉）。\n * - 工具条 Toolbar 仅作为 UL 的兄弟节点插入（上/下），不改动 UL 本体。\n * - 在 cards 模式下完全不触碰 UL，只插 Toolbar。\n * - 未找到 UL 时不做任何 UL 追加（避免制造第二个 UL）。\n */\nexport default function () {\n  override(DiscussionList.prototype, 'view', function (original) {\n    const state = this.attrs?.state;\n    const tree = original();\n\n    // 给根增加类（不影响结构）\n    tree.attrs = tree.attrs || {};\n    tree.attrs.className = classList(\n      'DiscussionList',\n      { 'DiscussionList--searchResults': state?.isSearchResults?.() },\n      tree.attrs.className\n    );\n\n    // 非分页模式、加载中或空列表：不干预 UL，直接返回\n    if (!state?.usePaginationMode || state.isLoading?.() || state.isEmpty?.()) {\n      return tree;\n    }\n\n    const cardSupport = 'walsgit-discussion-cards' in flarum.extensions;\n\n    // 取当前页 items（用于生成 <li>）\n    const pageSize = state.options?.perPage || 0;\n    const pageNum = state.page || 1;\n    const params = state.getParams?.() || {};\n    const allPages = state.getPages ? state.getPages(true) : [];\n    let items = [];\n    if (Array.isArray(allPages) && allPages.length) {\n      const curr = allPages.find(p => p?.number === state.location?.page) || allPages[0];\n      if (curr && Array.isArray(curr.items)) items = curr.items;\n    }\n\n    const liChildren = items.length\n      ? items.map((discussion, itemNum) => (\n          <li\n            key={discussion.id()}\n            data-id={discussion.id()}\n            role=\"article\"\n            aria-setsize={-1}\n            aria-posinset={(pageNum * pageSize) + itemNum}\n          >\n            <DiscussionListItem discussion={discussion} params={params} />\n          </li>\n        ))\n      : null;\n\n    // 工具函数\n    const getClass = (attrs) => String((attrs && (attrs.className || attrs.class)) || '');\n    const isUlList = (n) => n && n.tag === 'ul' && getClass(n.attrs).includes('DiscussionList-discussions');\n    const childrenRef = (nodeOrArr) => {\n      if (Array.isArray(nodeOrArr)) return nodeOrArr;\n      if (nodeOrArr && Array.isArray(nodeOrArr.children)) return nodeOrArr.children;\n      return null;\n    };\n\n    // 深度收集所有 UL 以及其父引用\n    const uls = [];\n    (function walk(node, parent, indexInParent) {\n      if (!node) return;\n      if (Array.isArray(node)) {\n        for (let i = 0; i < node.length; i++) walk(node[i], node, i);\n        return;\n      }\n      if (typeof node === 'string' || typeof node === 'number') return;\n\n      if (isUlList(node)) uls.push({ node, parent, index: indexInParent });\n\n      const ch = childrenRef(node);\n      if (ch) for (let i = 0; i < ch.length; i++) walk(ch[i], node, i);\n    })(tree, null, null);\n\n    // cards 模式：不触碰 UL，只插 Toolbar\n    if (cardSupport) {\n      insertToolbars(position(), tree, uls.length ? uls[0] : null, state);\n      return tree;\n    }\n\n    // 非 cards：只原位替换 UL 的 children，并去除空壳 UL\n    if (uls.length > 0) {\n      // 选择要保留的 UL：优先已有 <li> 的；其次带 aria-busy 的；否则第一个\n      let keep = uls.find(e => {\n        const ch = childrenRef(e.node);\n        return ch && ch.some(c => c && c.tag === 'li');\n      }) || uls.find(e => e.node?.attrs && 'aria-busy' in e.node.attrs) || uls[0];\n\n      // 仅当我们生成了 liChildren 时才替换 children；否则保持原样\n      if (liChildren) {\n        const ch = childrenRef(keep.node);\n        if (ch) { ch.splice(0, ch.length, ...liChildren); }\n        else { keep.node.children = liChildren; }\n      }\n\n      // 删除其它空壳 UL（没有 <li> 的）\n      for (let i = uls.length - 1; i >= 0; i--) {\n        const e = uls[i];\n        if (e === keep) continue;\n        const parentArr = childrenRef(Array.isArray(e.parent) ? e.parent : e.parent);\n        if (!parentArr) continue;\n        const idx = e.index ?? parentArr.indexOf(e.node);\n        if (idx >= 0 && parentArr[idx] === e.node) {\n          const hasLi = (childrenRef(e.node) || []).some(c => c && c.tag === 'li');\n          if (!hasLi) parentArr.splice(idx, 1);\n        }\n      }\n\n      // 在保留的 UL 附近插入工具条\n      insertToolbars(position(), tree, keep, state);\n      return tree;\n    }\n\n    // 若未找到任何 UL：不追加 UL，避免制造第二个；只按需在根加 Toolbar\n    insertToolbars(position(), tree, null, state);\n    return tree;\n\n    function position() {\n      return app.forum.attribute('foskym-pagination.paginationPosition'); // 'above' | 'under' | 'both'\n    }\n\n    function insertToolbars(pos, rootTree, targetEntry, listState) {\n      const above = pos === 'above' || pos === 'both';\n      const under = pos === 'under' || pos === 'both';\n      if (!above && !under) return;\n\n      const toolbarVNode = Toolbar.component({ state: listState });\n\n      if (targetEntry && targetEntry.parent) {\n        const parent = targetEntry.parent;\n        const arr = childrenRef(Array.isArray(parent) ? parent : parent);\n        if (!arr) return;\n        let idx = targetEntry.index ?? arr.indexOf(targetEntry.node);\n        if (idx < 0) idx = 0;\n\n        if (above) arr.splice(idx, 0, toolbarVNode);\n        if (under) arr.splice(idx + (above ? 2 : 1), 0, toolbarVNode);\n      } else {\n        const rc = childrenRef(rootTree);\n        if (!rc) return;\n        if (above) rc.unshift(toolbarVNode);\n        if (under) rc.push(toolbarVNode);\n      }\n    }\n  });\n}\n\n","import app from 'flarum/common/app';\nimport { extend, override } from 'flarum/common/extend';\n\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\n\nimport addUserPreference from './addUserPreference';\nimport overrideDiscussionListState from './overrideDiscussionListState';\nimport overrideDiscussionList from './overrideDiscussionList';\n\n\napp.initializers.add('foskym/flarum-pagination', () => {\n  addUserPreference();\n  overrideDiscussionListState();\n  overrideDiscussionList();\n\n  extend(DiscussionControls, 'deleteAction', function () {\n    if (!this.usePaginationMode) {\n      return;\n    }\n\n    if (app.discussions) {\n      let page = app.discussions.location.page;\n      app.discussions.refresh(page);\n    }\n  });\n\n  extend(DiscussionComposer.prototype, 'onsubmit', function () {\n    if (!this.usePaginationMode) {\n      return;\n    }\n\n    if (app.discussions) {\n      // let page = app.discussions.location.page;\n      app.discussions.refresh();\n    }\n  });\n}, -2); // load later to deal with `walsgit-discussion-cards`\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport SettingsPage from 'flarum/forum/components/SettingsPage';\nimport FieldSet from 'flarum/common/components/FieldSet';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Switch from 'flarum/common/components/Switch';\nimport Stream from 'flarum/common/utils/Stream';\n\nexport default function () {\n  extend(SettingsPage.prototype, 'oninit', function () {\n    const user = this.user;\n    const preferences = user.preferences();\n    this.userCustom = Stream(preferences['foskym-pagination.userCustom']);\n    this.userPaginationOnLoading = Stream(preferences['foskym-pagination.userPaginationOnLoading']);\n  });\n\n  extend(SettingsPage.prototype, 'settingsItems', function (items) {\n    if (Boolean(app.forum.attribute('foskym-pagination.canUserPref'))) {\n      items.add(\n        'pagination_settings',\n        FieldSet.component(\n          {\n            label: app.translator.trans('foskym-pagination.forum.user.settings.head'),\n            className: 'SettingsPage-pagination',\n          },\n          this.Pagination_UserPrefItems().toArray()\n        )\n      );\n    }\n  });\n\n  SettingsPage.prototype['Pagination_UserPrefItems'] = function () {\n    const items = new ItemList();\n    items.add(\n      'foskym-pagination.userCustom',\n      Switch.component(\n        {\n          state: this.user.preferences()['foskym-pagination.userCustom'],\n          onchange: (value) => {\n            this.UserCustom_Loading = true;\n            this.user.savePreferences({ 'foskym-pagination.userCustom': value }).then(() => {\n              this.UserCustom_Loading = false;\n              m.redraw();\n            });\n          },\n          loading: this.UserCustom_Loading,\n        },\n        app.translator.trans('foskym-pagination.forum.user.settings.userCustom')\n      )\n    );\n\n    if (this.user.preferences()['foskym-pagination.userCustom']) {\n      items.add(\n        'foskym-pagination.userPaginationOnLoading',\n        Switch.component(\n          {\n            state: this.user.preferences()['foskym-pagination.userPaginationOnLoading'],\n            onchange: (value) => {\n              this.userPaginationOnLoading_Loading = true;\n              this.user.savePreferences({ 'foskym-pagination.userPaginationOnLoading': value }).then(() => {\n                this.userPaginationOnLoading_Loading = false;\n                m.redraw();\n              });\n            },\n            loading: this.userPaginationOnLoading_Loading,\n          },\n          app.translator.trans('foskym-pagination.forum.user.settings.userPaginationOnLoading')\n        )\n      );\n    }\n\n    return items;\n  };\n}\n","import app from 'flarum/forum/app';\n\nexport default function () {\n  if (app.session.user === null) {\n    return app.forum.attribute('foskym-pagination.paginationOnLoading');\n  }\n\n  const preferences = app.session.user.preferences() as any;\n\n  if (app.forum.attribute('foskym-pagination.canUserPref')) {\n    if (!preferences['foskym-pagination.userCustom']) {\n      return app.forum.attribute('foskym-pagination.paginationOnLoading');\n    } else {\n      if (!preferences['foskym-pagination.userPaginationOnLoading']) {\n        return false;\n      }\n    }\n  } else {\n    return app.forum.attribute('foskym-pagination.paginationOnLoading');\n  }\n\n  return true;\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_extends","assign","bind","target","i","arguments","length","source","apply","this","setPageToURL","n","replace","u","URL","window","location","href","searchParams","set","String","newUrl","pathname","search","hash","history","replaceState","pushState","_setPrototypeOf","p","setPrototypeOf","__proto__","Toolbar","subClass","superClass","attrs","create","constructor","view","vnode","state","className","class","buttonFirst","buttonBack","ctrl","pageList","map","page","title","number","onclick","toPage","buttonNext","buttonLast","inputJump","buttonJump","Button","icon","disabled","parseInt","totalPages","JumpFunc","input","document","getElementById","Number","isFinite","isSafeInteger","m","id","placeholder","undefined","onkeydown","event","redraw","keyCode","Component","override","DiscussionList","original","tree","classList","isSearchResults","usePaginationMode","isLoading","isEmpty","cardSupport","extensions","pageSize","options","perPage","pageNum","params","getParams","allPages","getPages","items","Array","isArray","curr","find","liChildren","discussion","itemNum","role","childrenRef","nodeOrArr","children","uls","walk","node","parent","indexInParent","tag","includes","push","index","ch","insertToolbars","position","keep","e","some","c","splice","parentArr","idx","indexOf","app","pos","rootTree","targetEntry","listState","above","under","toolbarVNode","component","arr","rc","unshift","extend","SettingsPage","preferences","user","userCustom","Stream","userPaginationOnLoading","Boolean","add","FieldSet","label","Pagination_UserPrefItems","toArray","ItemList","Switch","onchange","UserCustom_Loading","savePreferences","then","loading","userPaginationOnLoading_Loading","DiscussionListState","cacheDiscussions","perLoadMore","perIndexInit","leftEdges","rightEdges","determineMode","lastTotalDiscussionCount","lastTotalPages","lastDiscussions","lastLoadedPage","lastRequestParams","optionInitialized","ret","refresh","Promise","resolve","initOptions","targetPage","getPageFromURL","initialLoading","loadingPrev","loadingNext","isRefreshing","clear","loadPage","results","pages","parseResults","reqParams","requestParams","preloadedDiscussions","totalDiscussionCount","payload","jsonapi","totalResultsCount","includeChanged","JSON","stringify","filterChanged","sortChanged","start","end","slice","setTimeout","newOffset","newLimit","include","join","Math","min","max","offset","limit","type","extraDiscussions","concat","pg","flat","getAllPages","links","hasNext","next","hasPrev","prev","hasPage","num","all","sort","b","getTotalPages","ceil","scrollToTop","container","querySelector","header","offsetY","clientHeight","getBoundingClientRect","top","scrollY","scrollTo","behavior","prevPage","current","r","nextPage","left","right","clearTimeout","__rtRefreshTimer","overrideDiscussionList","DiscussionControls","DiscussionComposer"],"sourceRoot":""}